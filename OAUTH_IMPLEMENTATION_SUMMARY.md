# OAuth ç™»å½•åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ‰ å®ç°å®Œæˆ

å·²æˆåŠŸä¸ºé¡¹ç›®æ·»åŠ äº†å®Œæ•´çš„ Google å’Œ GitHub OAuth ç™»å½•åŠŸèƒ½ï¼ŒåŸºäºæ ‡å‡† OAuth 2.0 åè®®å®ç°ã€‚

## ğŸ“‹ å®ç°çš„åŠŸèƒ½

### âœ… åç«¯åŠŸèƒ½
- **OAuth æœåŠ¡å±‚**ï¼šå®Œæ•´çš„ OAuth è®¤è¯æœåŠ¡å®ç°
- **API ç«¯ç‚¹**ï¼šRESTful OAuth API æ¥å£
- **ç”¨æˆ·ç®¡ç†**ï¼šOAuth ç”¨æˆ·åˆ›å»ºå’Œå…³è”é€»è¾‘
- **æ•°æ®åº“æ‰©å±•**ï¼šæ”¯æŒ OAuth å­—æ®µçš„ç”¨æˆ·è¡¨
- **é…ç½®ç®¡ç†**ï¼šçµæ´»çš„ OAuth é…ç½®ç³»ç»Ÿ
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### âœ… å‰ç«¯åŠŸèƒ½
- **OAuth æŒ‰é’®**ï¼šGoogle å’Œ GitHub ç™»å½•æŒ‰é’®
- **å›è°ƒå¤„ç†**ï¼šOAuth å›è°ƒé¡µé¢å’ŒçŠ¶æ€ç®¡ç†
- **è®¤è¯é›†æˆ**ï¼šä¸ç°æœ‰è®¤è¯ç³»ç»Ÿæ— ç¼é›†æˆ
- **å›½é™…åŒ–æ”¯æŒ**ï¼šå¤šè¯­è¨€ OAuth ç•Œé¢
- **é”™è¯¯å¤„ç†**ï¼šç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### âœ… é…ç½®å’Œéƒ¨ç½²
- **é…ç½®æ–‡æ¡£**ï¼šè¯¦ç»†çš„é…ç½®æŒ‡å—
- **æµ‹è¯•å·¥å…·**ï¼šOAuth åŠŸèƒ½æµ‹è¯•è„šæœ¬
- **éƒ¨ç½²æŒ‡å—**ï¼šå®Œæ•´çš„éƒ¨ç½²è¯´æ˜
- **æ•…éšœæ’é™¤**ï¼šå¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OAuth Handler â”‚â”€â”€â”€â”€â”‚  OAuth Service  â”‚â”€â”€â”€â”€â”‚ User Repository â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Routes   â”‚    â”‚  OAuth Clients  â”‚    â”‚   PostgreSQL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰ç«¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OAuth Buttons   â”‚â”€â”€â”€â”€â”‚  Auth Context   â”‚â”€â”€â”€â”€â”‚  Auth Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Callback Page   â”‚    â”‚  State Managementâ”‚    â”‚   HTTP Client   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒæ–‡ä»¶

### åç«¯æ ¸å¿ƒæ–‡ä»¶
- `internal/application/services/oauth_service.go` - OAuth æœåŠ¡å®ç°
- `internal/presentation/handlers/oauth_handler.go` - HTTP å¤„ç†å™¨
- `internal/domain/entities/user.go` - ç”¨æˆ·å®ä½“æ‰©å±•
- `internal/infrastructure/config/config.go` - é…ç½®ç»“æ„

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶
- `web/src/components/oauth-buttons/oauth-buttons.tsx` - OAuth æŒ‰é’®ç»„ä»¶
- `web/src/pages/auth/oauth-callback.tsx` - å›è°ƒé¡µé¢
- `web/src/services/auth.ts` - è®¤è¯æœåŠ¡æ‰©å±•
- `web/src/contexts/auth-context.tsx` - è®¤è¯ä¸Šä¸‹æ–‡

### é…ç½®æ–‡ä»¶
- `configs/config.yaml` - åº”ç”¨é…ç½®
- `.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
- `docs/oauth-setup.md` - é…ç½®æŒ‡å—
- `docs/oauth-deployment-guide.md` - éƒ¨ç½²æŒ‡å—

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. é…ç½® OAuth åº”ç”¨
- Google: [Google Cloud Console](https://console.cloud.google.com/)
- GitHub: [GitHub Developer Settings](https://github.com/settings/developers)

### 2. è®¾ç½®ç¯å¢ƒå˜é‡
```bash
OAUTH_GOOGLE_ENABLED=true
OAUTH_GOOGLE_CLIENT_ID=your_client_id
OAUTH_GOOGLE_CLIENT_SECRET=your_client_secret

OAUTH_GITHUB_ENABLED=true
OAUTH_GITHUB_CLIENT_ID=your_client_id
OAUTH_GITHUB_CLIENT_SECRET=your_client_secret
```

### 3. å¯åŠ¨åº”ç”¨
```bash
# åç«¯
go run cmd/server/main.go

# å‰ç«¯
cd web && npm run dev
```

### 4. æµ‹è¯•åŠŸèƒ½
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./scripts/test-oauth.sh

# éªŒè¯é…ç½®
go run cmd/oauth-test/main.go
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **çŠ¶æ€å‚æ•°éªŒè¯**ï¼šé˜²æ­¢ CSRF æ”»å‡»
- **å®‰å…¨çš„ä»¤ç‰Œå­˜å‚¨**ï¼šJWT ä»¤ç‰Œå®‰å…¨ç®¡ç†
- **ç¯å¢ƒå˜é‡ä¿æŠ¤**ï¼šæ•æ„Ÿä¿¡æ¯ä¸æš´éœ²åœ¨ä»£ç ä¸­
- **HTTPS æ”¯æŒ**ï¼šç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶ HTTPS
- **é”™è¯¯å¤„ç†**ï¼šå®‰å…¨çš„é”™è¯¯ä¿¡æ¯è¿”å›

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

- **æ— ç¼é›†æˆ**ï¼šä¸ç°æœ‰è®¤è¯ç³»ç»Ÿå®Œç¾å…¼å®¹
- **ç”¨æˆ·å…³è”**ï¼šæ”¯æŒé‚®ç®±åŒ¹é…çš„ç”¨æˆ·è´¦å·å…³è”
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç•Œé¢
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å„ç§è®¾å¤‡å±å¹•
- **ç¼“å­˜ä¼˜åŒ–**ï¼šç”¨æˆ·ä¿¡æ¯ç¼“å­˜æå‡æ€§èƒ½

## ğŸ“Š API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/auth/oauth/{provider}/url` | è·å– OAuth è®¤è¯ URL |
| POST | `/auth/oauth/{provider}/callback` | å¤„ç† OAuth å›è°ƒ |
| GET | `/auth/oauth/{provider}/redirect` | ç›´æ¥é‡å®šå‘åˆ° OAuth æä¾›å•† |

æ”¯æŒçš„æä¾›å•†ï¼š`google`, `github`

## ğŸ—„ï¸ æ•°æ®åº“å˜æ›´

æ–°å¢å­—æ®µåˆ° `users` è¡¨ï¼š
- `google_id` - Google OAuth ID
- `github_id` - GitHub OAuth ID
- `avatar` - ç”¨æˆ·å¤´åƒ URL
- `auth_method` - è®¤è¯æ–¹å¼

## ğŸ¯ åç»­æ‰©å±•

å¯ä»¥è½»æ¾æ‰©å±•æ”¯æŒæ›´å¤š OAuth æä¾›å•†ï¼š
- å¾®ä¿¡ç™»å½•
- é’‰é’‰ç™»å½•
- OIDC é€šç”¨ç™»å½•
- ä¼ä¸š SSO é›†æˆ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- è¯¦ç»†é…ç½®ï¼šæŸ¥çœ‹ `docs/oauth-setup.md`
- éƒ¨ç½²æŒ‡å—ï¼šæŸ¥çœ‹ `docs/oauth-deployment-guide.md`
- é—®é¢˜æ’æŸ¥ï¼šè¿è¡Œ `go run cmd/oauth-test/main.go`
- åŠŸèƒ½æµ‹è¯•ï¼šè¿è¡Œ `./scripts/test-oauth.sh`

---

**ğŸ‰ OAuth ç™»å½•åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶å¯æŠ•å…¥ä½¿ç”¨ï¼**
